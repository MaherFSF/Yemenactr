
> yeto-platform@1.0.0 test /home/ubuntu/yeto-platform
> vitest run --run


 RUN  v2.1.9 /home/ubuntu/yeto-platform

 âœ“ server/governance.test.ts (15 tests) 11ms
 âœ“ server/hardening.test.ts (42 tests) 27ms
 âœ“ server/integration.test.ts (35 tests) 118ms
 âœ“ server/ml/ml.test.ts (44 tests) 45ms
 âœ“ server/services/macroSectorAgent.test.ts (20 tests) 13ms
 âœ“ server/routers/updates.test.ts (23 tests) 31ms
 âœ“ server/evidenceTribunal.test.ts (35 tests) 20ms
 âœ“ server/reports.test.ts (30 tests) 18ms
 âœ“ server/services/knowledgeGraph.test.ts (23 tests) 18ms
 âœ“ server/analytics-engine.test.ts (16 tests) 34ms
 âœ“ server/routers/evidence.test.ts (17 tests) 13ms
 âœ“ server/connectors/connectors.test.ts (26 tests) 115ms
 âœ“ server/routers/partnerEngine.test.ts (20 tests) 16ms
 âœ“ server/services/sourceRegistry.test.ts (47 tests) 72ms
 âœ“ server/routers/vipCockpit.test.ts (13 tests) 25ms
stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Initialization > should create a new scheduler instance
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Initialization > should start the scheduler
âœ… Webhook delivery scheduler started (interval: 60s)
[2026-02-01T18:29:07.791Z] Processing pending webhook deliveries...
âœ… Webhook delivery processing complete
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Initialization > should stop the scheduler
âœ… Webhook delivery scheduler started (interval: 60s)
[2026-02-01T18:29:07.792Z] Processing pending webhook deliveries...
âœ… Webhook delivery processing complete
â¹ï¸  Webhook delivery scheduler stopped
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Initialization > should not start if already running
âœ… Webhook delivery scheduler started (interval: 60s)
[2026-02-01T18:29:07.795Z] Processing pending webhook deliveries...
âœ… Webhook delivery processing complete
âš ï¸  Webhook delivery scheduler already running
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should successfully deliver a webhook
ðŸ“¤ Delivering webhook: test-1
   URL: https://example.com/webhooks
   Event: ingestion.completed
   Attempt: 1/3

 âœ“ server/routers/publications.test.ts (21 tests) 18ms
stdout | server/connectors.test.ts
[AutoPublicationEngine] Initialized with 4 publication configs

 âœ“ server/connectors.test.ts (29 tests) 35ms
 âœ“ server/truthLayer.test.ts (37 tests) 14ms
 âœ“ server/routers/sectorPages.test.ts (13 tests) 19ms
 âœ“ server/routers/releaseGate.test.ts (29 tests) 16ms
 âœ“ server/routers/sourceRegistry.test.ts (11 tests) 327ms
   âœ“ Source Registry Router > getAll > should return sources from the database 309ms
 âœ“ server/yeto.test.ts (21 tests) 12ms
 âœ“ server/ml/oneBrain.test.ts (16 tests) 10ms
 âœ“ server/services/entityServices.test.ts (16 tests) 12ms
 âœ“ server/source-detail.test.ts (32 tests) 18ms
 âœ“ server/time-travel.test.ts (15 tests) 12ms
 âœ“ server/routers/feedMatrix.test.ts (9 tests) 214ms
 âœ“ server/services/literatureService.test.ts (13 tests) 15ms
stdout | server/ai.chat.test.ts
[AutoPublicationEngine] Initialized with 4 publication configs

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should successfully deliver a webhook
âŒ Webhook delivery failed with non-retryable status: 405
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should handle timeout errors
ðŸ“¤ Delivering webhook: test-timeout
   URL: https://httpbin.org/delay/20
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should handle timeout errors
â±ï¸  Webhook delivery timeout (100ms)
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should handle connection errors
ðŸ“¤ Delivering webhook: test-connection
   URL: https://invalid-domain-that-does-not-exist-12345.com
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should handle connection errors
ðŸ”Œ Webhook endpoint unreachable: ENOTFOUND
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should include correct headers in webhook delivery
ðŸ“¤ Delivering webhook: test-headers
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 2/3

 âœ“ server/routers/bulkClassification.test.ts (20 tests) 2041ms
   âœ“ Bulk Classification Database Integration > should have unknown tier below 50% 435ms
stdout | server/ai.chat.test.ts
[ConnectorRegistry] Registered connector: WorldBank

stdout | server/ai.chat.test.ts
[ConnectorRegistry] Registered connector: IMF

stdout | server/ai.chat.test.ts
[ConnectorRegistry] Registered connector: OCHA_FTS
[ConnectorRegistry] Registered connector: WFP_VAM
[ConnectorRegistry] Registered connector: FAO
[ConnectorRegistry] Registered connector: UNHCR

stdout | server/ai.chat.test.ts
[ConnectorRegistry] Registered connector: ReliefWeb
[ConnectorRegistry] Registered connector: ACLED
[ConnectorRegistry] Registered connector: HDX

stderr | server/ai.chat.test.ts > AI Assistant Chat > should handle errors gracefully
AI Assistant error: Error: LLM service unavailable
    at /home/ubuntu/yeto-platform/server/ai.chat.test.ts:97:48
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at file:///home/ubuntu/yeto-platform/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///home/ubuntu/yeto-platform/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///home/ubuntu/yeto-platform/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/ubuntu/yeto-platform/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/ubuntu/yeto-platform/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///home/ubuntu/yeto-platform/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
    at file:///home/ubuntu/yeto-platform/node_modules/.pnpm/vitest@2.1.9_@types+node@24.7.0_lightningcss@1.30.1/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11
    at withEnv (file:///home/ubuntu/yeto-platform/node_modules/.pnpm/vitest@2.1.9_@types+node@24.7.0_lightningcss@1.30.1/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:90:5)

 âœ“ server/ai.chat.test.ts (6 tests) 19ms
stdout | server/auth.logout.test.ts
[AutoPublicationEngine] Initialized with 4 publication configs

stdout | server/auth.logout.test.ts
[ConnectorRegistry] Registered connector: WorldBank

stdout | server/auth.logout.test.ts
[ConnectorRegistry] Registered connector: IMF

stdout | server/auth.logout.test.ts
[ConnectorRegistry] Registered connector: OCHA_FTS
[ConnectorRegistry] Registered connector: WFP_VAM
[ConnectorRegistry] Registered connector: FAO
[ConnectorRegistry] Registered connector: UNHCR

stdout | server/auth.logout.test.ts
[ConnectorRegistry] Registered connector: ReliefWeb
[ConnectorRegistry] Registered connector: ACLED
[ConnectorRegistry] Registered connector: HDX

 âœ“ server/auth.logout.test.ts (1 test) 6ms
 âœ“ server/placeholderDetector.test.ts (15 tests) 4792ms
   âœ“ Placeholder Detector > Time Series Data > should have valid numeric values (not suspicious patterns) 1452ms
   âœ“ Placeholder Detector > Research Publications > should not contain placeholder titles 343ms
stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should include correct headers in webhook delivery
âœ… Webhook delivered successfully (200, 3024ms)
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should handle bearer token authentication
ðŸ“¤ Delivering webhook: test-bearer-auth
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should handle bearer token authentication
âœ… Webhook delivered successfully (200, 1093ms)
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should handle API key authentication
ðŸ“¤ Delivering webhook: test-api-key-auth
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Webhook Delivery > should handle API key authentication
âœ… Webhook delivered successfully (200, 686ms)
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should calculate exponential backoff correctly
ðŸ“¤ Delivering webhook: test-backoff
   URL: https://example.com/webhooks
   Event: ingestion.completed
   Attempt: 3/5

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should calculate exponential backoff correctly
âŒ Webhook delivery failed with non-retryable status: 405
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify retryable HTTP status codes
ðŸ“¤ Delivering webhook: test-status-408
   URL: https://httpbin.org/status/408
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify retryable HTTP status codes
âš ï¸  Webhook delivery failed with retryable status: 408
ðŸ“¤ Delivering webhook: test-status-429
   URL: https://httpbin.org/status/429
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify retryable HTTP status codes
âš ï¸  Webhook delivery failed with retryable status: 429
ðŸ“¤ Delivering webhook: test-status-500
   URL: https://httpbin.org/status/500
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify retryable HTTP status codes
âš ï¸  Webhook delivery failed with retryable status: 500
ðŸ“¤ Delivering webhook: test-status-502
   URL: https://httpbin.org/status/502
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify retryable HTTP status codes
âš ï¸  Webhook delivery failed with retryable status: 502
ðŸ“¤ Delivering webhook: test-status-503
   URL: https://httpbin.org/status/503
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify retryable HTTP status codes
âš ï¸  Webhook delivery failed with retryable status: 503
ðŸ“¤ Delivering webhook: test-status-504
   URL: https://httpbin.org/status/504
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify retryable HTTP status codes
âš ï¸  Webhook delivery failed with retryable status: 504
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify non-retryable HTTP status codes
ðŸ“¤ Delivering webhook: test-status-400
   URL: https://httpbin.org/status/400
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify non-retryable HTTP status codes
âŒ Webhook delivery failed with non-retryable status: 400
ðŸ“¤ Delivering webhook: test-status-401
   URL: https://httpbin.org/status/401
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify non-retryable HTTP status codes
âŒ Webhook delivery failed with non-retryable status: 401
ðŸ“¤ Delivering webhook: test-status-403
   URL: https://httpbin.org/status/403
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify non-retryable HTTP status codes
âŒ Webhook delivery failed with non-retryable status: 403
ðŸ“¤ Delivering webhook: test-status-404
   URL: https://httpbin.org/status/404
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Retry Logic > should identify non-retryable HTTP status codes
âŒ Webhook delivery failed with non-retryable status: 404
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Scheduler Status > should report scheduler status
âœ… Webhook delivery scheduler started (interval: 60s)
[2026-02-01T18:29:22.645Z] Processing pending webhook deliveries...
âœ… Webhook delivery processing complete
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Edge Cases > should handle empty webhook payload
ðŸ“¤ Delivering webhook: test-empty-payload
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Edge Cases > should handle empty webhook payload
âœ… Webhook delivered successfully (200, 583ms)
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Edge Cases > should handle large webhook payload
ðŸ“¤ Delivering webhook: test-large-payload
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Edge Cases > should handle large webhook payload
âœ… Webhook delivered successfully (200, 1484ms)
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Edge Cases > should handle special characters in URL
ðŸ“¤ Delivering webhook: test-special-chars
   URL: https://example.com/webhooks?token=abc123&user=test@example.com
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Edge Cases > should handle special characters in URL
âŒ Webhook delivery failed with non-retryable status: 405
â¹ï¸  Webhook delivery scheduler stopped

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Concurrency > should handle multiple concurrent deliveries
ðŸ“¤ Delivering webhook: test-concurrent-0
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3
ðŸ“¤ Delivering webhook: test-concurrent-1
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3
ðŸ“¤ Delivering webhook: test-concurrent-2
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3
ðŸ“¤ Delivering webhook: test-concurrent-3
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3
ðŸ“¤ Delivering webhook: test-concurrent-4
   URL: https://httpbin.org/post
   Event: ingestion.completed
   Attempt: 1/3

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Concurrency > should handle multiple concurrent deliveries
âœ… Webhook delivered successfully (200, 595ms)

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Concurrency > should handle multiple concurrent deliveries
âœ… Webhook delivered successfully (200, 2828ms)

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Concurrency > should handle multiple concurrent deliveries
âœ… Webhook delivered successfully (200, 2990ms)

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Concurrency > should handle multiple concurrent deliveries
âœ… Webhook delivered successfully (200, 3050ms)

stdout | server/services/webhook-delivery-scheduler.test.ts > WebhookDeliveryScheduler > Concurrency > should handle multiple concurrent deliveries
âœ… Webhook delivered successfully (200, 3719ms)
â¹ï¸  Webhook delivery scheduler stopped

 âœ“ server/services/webhook-delivery-scheduler.test.ts (18 tests) 22768ms
   âœ“ WebhookDeliveryScheduler > Webhook Delivery > should successfully deliver a webhook 2685ms
   âœ“ WebhookDeliveryScheduler > Webhook Delivery > should include correct headers in webhook delivery 3025ms
   âœ“ WebhookDeliveryScheduler > Webhook Delivery > should handle bearer token authentication 1094ms
   âœ“ WebhookDeliveryScheduler > Webhook Delivery > should handle API key authentication 687ms
   âœ“ WebhookDeliveryScheduler > Retry Logic > should calculate exponential backoff correctly 706ms
   âœ“ WebhookDeliveryScheduler > Retry Logic > should identify retryable HTTP status codes 3866ms
   âœ“ WebhookDeliveryScheduler > Retry Logic > should identify non-retryable HTTP status codes 2664ms
   âœ“ WebhookDeliveryScheduler > Edge Cases > should handle empty webhook payload 584ms
   âœ“ WebhookDeliveryScheduler > Edge Cases > should handle large webhook payload 1485ms
   âœ“ WebhookDeliveryScheduler > Edge Cases > should handle special characters in URL 2119ms
   âœ“ WebhookDeliveryScheduler > Concurrency > should handle multiple concurrent deliveries 3721ms
 âœ“ server/connectorHealthAlerts.test.ts (8 tests) 21470ms
   âœ“ Connector Health Alerts > checkConnectorHealth > should return health status for all connectors 5162ms
   âœ“ Connector Health Alerts > checkConnectorHealth > should use default config when none provided 3962ms
   âœ“ Connector Health Alerts > checkConnectorHealth > should respect custom threshold config 3970ms
   âœ“ Connector Health Alerts > Health Status Determination > should mark connectors with errors as critical 3958ms
   âœ“ Connector Health Alerts > Health Status Determination > should include all expected connectors 3966ms

 Test Files  34 passed (34)
      Tests  736 passed (736)
   Start at  13:29:05
   Duration  25.83s (transform 3.67s, setup 0ms, collect 9.30s, tests 52.40s, environment 9ms, prepare 3.19s)

