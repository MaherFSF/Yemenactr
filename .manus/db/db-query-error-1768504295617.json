{
  "query": "\n-- Create notification_preferences_enhanced table\nCREATE TABLE IF NOT EXISTS notification_preferences_enhanced (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT,\n  email VARCHAR(320) NOT NULL,\n  exchangeRateAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  exchangeRateThreshold DECIMAL(5,2) DEFAULT 2.00,\n  exchangeRateRegions JSON DEFAULT '[\"both\"]',\n  bankingAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  tradeAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  energyAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  foodSecurityAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  humanitarianAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  fiscalAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  macroeconomicAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  newPublicationsAlert BOOLEAN DEFAULT TRUE NOT NULL,\n  publicationCategories JSON,\n  publicationOrganizations JSON,\n  weeklyDigest BOOLEAN DEFAULT TRUE NOT NULL,\n  weeklyDigestDay ENUM('monday','tuesday','wednesday','thursday','friday','saturday','sunday') DEFAULT 'monday',\n  monthlyReport BOOLEAN DEFAULT TRUE NOT NULL,\n  monthlyReportDay INT DEFAULT 1,\n  quarterlyReport BOOLEAN DEFAULT TRUE NOT NULL,\n  annualReport BOOLEAN DEFAULT TRUE NOT NULL,\n  preferredLanguage ENUM('en','ar','both') DEFAULT 'both' NOT NULL,\n  reportFormat ENUM('pdf','html','both') DEFAULT 'pdf' NOT NULL,\n  includeCharts BOOLEAN DEFAULT TRUE NOT NULL,\n  includeDataTables BOOLEAN DEFAULT TRUE NOT NULL,\n  deliveryFrequency ENUM('immediate','daily_digest','weekly_digest') DEFAULT 'daily_digest' NOT NULL,\n  quietHoursStart INT,\n  quietHoursEnd INT,\n  timezone VARCHAR(50) DEFAULT 'Asia/Aden',\n  isVerified BOOLEAN DEFAULT FALSE NOT NULL,\n  verificationToken VARCHAR(64),\n  verifiedAt TIMESTAMP NULL,\n  unsubscribeToken VARCHAR(64) NOT NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  unsubscribedAt TIMESTAMP NULL,\n  unsubscribeReason TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX notification_user_idx (userId),\n  INDEX notification_email_idx (email),\n  INDEX notification_active_idx (isActive),\n  INDEX notification_verification_idx (verificationToken),\n  FOREIGN KEY (userId) REFERENCES users(id)\n);\n\n-- Create scheduled_report_deliveries table\nCREATE TABLE IF NOT EXISTS scheduled_report_deliveries (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  reportType ENUM('weekly_digest','monthly_report','quarterly_report','annual_report','custom_report','alert_digest') NOT NULL,\n  reportPeriodStart TIMESTAMP NOT NULL,\n  reportPeriodEnd TIMESTAMP NOT NULL,\n  reportTitle VARCHAR(255) NOT NULL,\n  reportTitleAr VARCHAR(255),\n  pdfFileKey VARCHAR(255),\n  pdfFileUrl TEXT,\n  htmlFileKey VARCHAR(255),\n  htmlFileUrl TEXT,\n  generationStatus ENUM('pending','generating','completed','failed') DEFAULT 'pending' NOT NULL,\n  generatedAt TIMESTAMP NULL,\n  generationError TEXT,\n  totalRecipients INT DEFAULT 0 NOT NULL,\n  deliveredCount INT DEFAULT 0 NOT NULL,\n  failedCount INT DEFAULT 0 NOT NULL,\n  openedCount INT DEFAULT 0 NOT NULL,\n  clickedCount INT DEFAULT 0 NOT NULL,\n  scheduledFor TIMESTAMP NOT NULL,\n  deliveryStartedAt TIMESTAMP NULL,\n  deliveryCompletedAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX scheduled_report_type_idx (reportType),\n  INDEX scheduled_for_idx (scheduledFor),\n  INDEX generation_status_idx (generationStatus)\n);\n\n-- Create email_delivery_log table\nCREATE TABLE IF NOT EXISTS email_delivery_log (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  recipientEmail VARCHAR(320) NOT NULL,\n  recipientName VARCHAR(255),\n  notificationPreferenceId INT,\n  emailType ENUM('verification','alert','weekly_digest','monthly_report','quarterly_report','annual_report','publication_notification','custom_notification') NOT NULL,\n  subject VARCHAR(500) NOT NULL,\n  language ENUM('en','ar') DEFAULT 'en' NOT NULL,\n  scheduledReportId INT,\n  status ENUM('pending','sent','delivered','bounced','failed','opened','clicked') DEFAULT 'pending' NOT NULL,\n  sentAt TIMESTAMP NULL,\n  deliveredAt TIMESTAMP NULL,\n  openedAt TIMESTAMP NULL,\n  clickedAt TIMESTAMP NULL,\n  bouncedAt TIMESTAMP NULL,\n  errorMessage TEXT,\n  retryCount INT DEFAULT 0 NOT NULL,\n  lastRetryAt TIMESTAMP NULL,\n  messageId VARCHAR(255),\n  providerResponse JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX delivery_recipient_idx (recipientEmail),\n  INDEX delivery_type_idx (emailType),\n  INDEX delivery_status_idx (status),\n  INDEX delivery_sent_idx (sentAt),\n  INDEX delivery_report_idx (scheduledReportId),\n  FOREIGN KEY (notificationPreferenceId) REFERENCES notification_preferences_enhanced(id),\n  FOREIGN KEY (scheduledReportId) REFERENCES scheduled_report_deliveries(id)\n);\n\n-- Create alert_queue table\nCREATE TABLE IF NOT EXISTS alert_queue (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  alertType ENUM('exchange_rate_change','significant_event','new_publication','data_update','system_notification') NOT NULL,\n  titleEn VARCHAR(255) NOT NULL,\n  titleAr VARCHAR(255) NOT NULL,\n  contentEn TEXT NOT NULL,\n  contentAr TEXT NOT NULL,\n  indicatorCode VARCHAR(100),\n  region ENUM('aden','sanaa','both'),\n  sector VARCHAR(100),\n  publicationId INT,\n  priority ENUM('low','normal','high','urgent') DEFAULT 'normal' NOT NULL,\n  status ENUM('pending','processing','completed','failed') DEFAULT 'pending' NOT NULL,\n  processedAt TIMESTAMP NULL,\n  recipientCount INT DEFAULT 0 NOT NULL,\n  deduplicationKey VARCHAR(255),\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  expiresAt TIMESTAMP NULL,\n  INDEX queue_alert_type_idx (alertType),\n  INDEX queue_status_idx (status),\n  INDEX queue_priority_idx (priority),\n  INDEX queue_dedup_idx (deduplicationKey),\n  FOREIGN KEY (publicationId) REFERENCES research_publications(id)\n);\n\n-- Create institutional_subscribers table\nCREATE TABLE IF NOT EXISTS institutional_subscribers (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  organizationName VARCHAR(255) NOT NULL,\n  organizationNameAr VARCHAR(255),\n  organizationType ENUM('donor','un_agency','ngo','government','central_bank','commercial_bank','research_institution','media','embassy','other') NOT NULL,\n  primaryContactName VARCHAR(255) NOT NULL,\n  primaryContactEmail VARCHAR(320) NOT NULL,\n  secondaryContactEmail VARCHAR(320),\n  subscriptionTier ENUM('basic','professional','enterprise') DEFAULT 'basic' NOT NULL,\n  customReportAccess BOOLEAN DEFAULT FALSE NOT NULL,\n  apiAccess BOOLEAN DEFAULT FALSE NOT NULL,\n  receiveWeeklyDigest BOOLEAN DEFAULT TRUE NOT NULL,\n  receiveMonthlyReport BOOLEAN DEFAULT TRUE NOT NULL,\n  receiveQuarterlyReport BOOLEAN DEFAULT TRUE NOT NULL,\n  receiveAnnualReport BOOLEAN DEFAULT TRUE NOT NULL,\n  preferredLanguage ENUM('en','ar','both') DEFAULT 'both' NOT NULL,\n  interestedSectors JSON,\n  interestedIndicators JSON,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  activatedAt TIMESTAMP NULL,\n  deactivatedAt TIMESTAMP NULL,\n  notes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX inst_org_name_idx (organizationName),\n  INDEX inst_org_type_idx (organizationType),\n  INDEX inst_primary_email_idx (primaryContactEmail),\n  INDEX inst_active_idx (isActive)\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 4DB9hJWqLzCzJpD.4ae2ba9639dc --database XodoyKMzPdFiKkVj3QFTGK --execute \n-- Create notification_preferences_enhanced table\nCREATE TABLE IF NOT EXISTS notification_preferences_enhanced (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT,\n  email VARCHAR(320) NOT NULL,\n  exchangeRateAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  exchangeRateThreshold DECIMAL(5,2) DEFAULT 2.00,\n  exchangeRateRegions JSON DEFAULT '[\"both\"]',\n  bankingAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  tradeAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  energyAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  foodSecurityAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  humanitarianAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  fiscalAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  macroeconomicAlerts BOOLEAN DEFAULT TRUE NOT NULL,\n  newPublicationsAlert BOOLEAN DEFAULT TRUE NOT NULL,\n  publicationCategories JSON,\n  publicationOrganizations JSON,\n  weeklyDigest BOOLEAN DEFAULT TRUE NOT NULL,\n  weeklyDigestDay ENUM('monday','tuesday','wednesday','thursday','friday','saturday','sunday') DEFAULT 'monday',\n  monthlyReport BOOLEAN DEFAULT TRUE NOT NULL,\n  monthlyReportDay INT DEFAULT 1,\n  quarterlyReport BOOLEAN DEFAULT TRUE NOT NULL,\n  annualReport BOOLEAN DEFAULT TRUE NOT NULL,\n  preferredLanguage ENUM('en','ar','both') DEFAULT 'both' NOT NULL,\n  reportFormat ENUM('pdf','html','both') DEFAULT 'pdf' NOT NULL,\n  includeCharts BOOLEAN DEFAULT TRUE NOT NULL,\n  includeDataTables BOOLEAN DEFAULT TRUE NOT NULL,\n  deliveryFrequency ENUM('immediate','daily_digest','weekly_digest') DEFAULT 'daily_digest' NOT NULL,\n  quietHoursStart INT,\n  quietHoursEnd INT,\n  timezone VARCHAR(50) DEFAULT 'Asia/Aden',\n  isVerified BOOLEAN DEFAULT FALSE NOT NULL,\n  verificationToken VARCHAR(64),\n  verifiedAt TIMESTAMP NULL,\n  unsubscribeToken VARCHAR(64) NOT NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  unsubscribedAt TIMESTAMP NULL,\n  unsubscribeReason TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX notification_user_idx (userId),\n  INDEX notification_email_idx (email),\n  INDEX notification_active_idx (isActive),\n  INDEX notification_verification_idx (verificationToken),\n  FOREIGN KEY (userId) REFERENCES users(id)\n);\n\n-- Create scheduled_report_deliveries table\nCREATE TABLE IF NOT EXISTS scheduled_report_deliveries (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  reportType ENUM('weekly_digest','monthly_report','quarterly_report','annual_report','custom_report','alert_digest') NOT NULL,\n  reportPeriodStart TIMESTAMP NOT NULL,\n  reportPeriodEnd TIMESTAMP NOT NULL,\n  reportTitle VARCHAR(255) NOT NULL,\n  reportTitleAr VARCHAR(255),\n  pdfFileKey VARCHAR(255),\n  pdfFileUrl TEXT,\n  htmlFileKey VARCHAR(255),\n  htmlFileUrl TEXT,\n  generationStatus ENUM('pending','generating','completed','failed') DEFAULT 'pending' NOT NULL,\n  generatedAt TIMESTAMP NULL,\n  generationError TEXT,\n  totalRecipients INT DEFAULT 0 NOT NULL,\n  deliveredCount INT DEFAULT 0 NOT NULL,\n  failedCount INT DEFAULT 0 NOT NULL,\n  openedCount INT DEFAULT 0 NOT NULL,\n  clickedCount INT DEFAULT 0 NOT NULL,\n  scheduledFor TIMESTAMP NOT NULL,\n  deliveryStartedAt TIMESTAMP NULL,\n  deliveryCompletedAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX scheduled_report_type_idx (reportType),\n  INDEX scheduled_for_idx (scheduledFor),\n  INDEX generation_status_idx (generationStatus)\n);\n\n-- Create email_delivery_log table\nCREATE TABLE IF NOT EXISTS email_delivery_log (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  recipientEmail VARCHAR(320) NOT NULL,\n  recipientName VARCHAR(255),\n  notificationPreferenceId INT,\n  emailType ENUM('verification','alert','weekly_digest','monthly_report','quarterly_report','annual_report','publication_notification','custom_notification') NOT NULL,\n  subject VARCHAR(500) NOT NULL,\n  language ENUM('en','ar') DEFAULT 'en' NOT NULL,\n  scheduledReportId INT,\n  status ENUM('pending','sent','delivered','bounced','failed','opened','clicked') DEFAULT 'pending' NOT NULL,\n  sentAt TIMESTAMP NULL,\n  deliveredAt TIMESTAMP NULL,\n  openedAt TIMESTAMP NULL,\n  clickedAt TIMESTAMP NULL,\n  bouncedAt TIMESTAMP NULL,\n  errorMessage TEXT,\n  retryCount INT DEFAULT 0 NOT NULL,\n  lastRetryAt TIMESTAMP NULL,\n  messageId VARCHAR(255),\n  providerResponse JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX delivery_recipient_idx (recipientEmail),\n  INDEX delivery_type_idx (emailType),\n  INDEX delivery_status_idx (status),\n  INDEX delivery_sent_idx (sentAt),\n  INDEX delivery_report_idx (scheduledReportId),\n  FOREIGN KEY (notificationPreferenceId) REFERENCES notification_preferences_enhanced(id),\n  FOREIGN KEY (scheduledReportId) REFERENCES scheduled_report_deliveries(id)\n);\n\n-- Create alert_queue table\nCREATE TABLE IF NOT EXISTS alert_queue (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  alertType ENUM('exchange_rate_change','significant_event','new_publication','data_update','system_notification') NOT NULL,\n  titleEn VARCHAR(255) NOT NULL,\n  titleAr VARCHAR(255) NOT NULL,\n  contentEn TEXT NOT NULL,\n  contentAr TEXT NOT NULL,\n  indicatorCode VARCHAR(100),\n  region ENUM('aden','sanaa','both'),\n  sector VARCHAR(100),\n  publicationId INT,\n  priority ENUM('low','normal','high','urgent') DEFAULT 'normal' NOT NULL,\n  status ENUM('pending','processing','completed','failed') DEFAULT 'pending' NOT NULL,\n  processedAt TIMESTAMP NULL,\n  recipientCount INT DEFAULT 0 NOT NULL,\n  deduplicationKey VARCHAR(255),\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  expiresAt TIMESTAMP NULL,\n  INDEX queue_alert_type_idx (alertType),\n  INDEX queue_status_idx (status),\n  INDEX queue_priority_idx (priority),\n  INDEX queue_dedup_idx (deduplicationKey),\n  FOREIGN KEY (publicationId) REFERENCES research_publications(id)\n);\n\n-- Create institutional_subscribers table\nCREATE TABLE IF NOT EXISTS institutional_subscribers (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  organizationName VARCHAR(255) NOT NULL,\n  organizationNameAr VARCHAR(255),\n  organizationType ENUM('donor','un_agency','ngo','government','central_bank','commercial_bank','research_institution','media','embassy','other') NOT NULL,\n  primaryContactName VARCHAR(255) NOT NULL,\n  primaryContactEmail VARCHAR(320) NOT NULL,\n  secondaryContactEmail VARCHAR(320),\n  subscriptionTier ENUM('basic','professional','enterprise') DEFAULT 'basic' NOT NULL,\n  customReportAccess BOOLEAN DEFAULT FALSE NOT NULL,\n  apiAccess BOOLEAN DEFAULT FALSE NOT NULL,\n  receiveWeeklyDigest BOOLEAN DEFAULT TRUE NOT NULL,\n  receiveMonthlyReport BOOLEAN DEFAULT TRUE NOT NULL,\n  receiveQuarterlyReport BOOLEAN DEFAULT TRUE NOT NULL,\n  receiveAnnualReport BOOLEAN DEFAULT TRUE NOT NULL,\n  preferredLanguage ENUM('en','ar','both') DEFAULT 'both' NOT NULL,\n  interestedSectors JSON,\n  interestedIndicators JSON,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  activatedAt TIMESTAMP NULL,\n  deactivatedAt TIMESTAMP NULL,\n  notes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX inst_org_name_idx (organizationName),\n  INDEX inst_org_type_idx (organizationType),\n  INDEX inst_primary_email_idx (primaryContactEmail),\n  INDEX inst_active_idx (isActive)\n);\n",
  "returncode": 1,
  "logs": [
    "ERROR 1101 (42000) at line 3: BLOB/TEXT/JSON column 'exchangeRateRegions' can't have a default value"
  ]
}